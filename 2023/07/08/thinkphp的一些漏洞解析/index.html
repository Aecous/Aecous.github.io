<!DOCTYPE html>
<html lang="en" color-mode="light">
  <head><meta name="referrer" content="no-referrer"/><meta name="generator" content="Hexo 6.3.0"></head>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <meta name="author" content="John Doe" />
  <meta name="description" content="" />
  
  
  <title>
    
      thinkphp的一些漏洞解析 
      
      
      |
    
     Prove yourself
  </title>

  
    <link rel="apple-touch-icon" href="/images/myblog.ico">
    <link rel="icon" href="/images/myblog.ico">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/me.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Aecous</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">thinkphp的一些漏洞解析</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2023-07-08 17:09:39
        </span>
        
      </div>
      <div class="markdown-body">
        <h3 id="think5-1-反序列化"><a href="#think5-1-反序列化" class="headerlink" title="think5.1  反序列化"></a>think5.1  反序列化</h3><p>入口点<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037813392-071fafce-6df3-4e27-80a5-be3acac558b8.png#averageHue=%232a2d2f&clientId=uc32c4d9b-bbe2-4&from=paste&height=396&id=ud49cb208&originHeight=594&originWidth=1909&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=89407&status=done&style=none&taskId=u18f76bc6-ef73-4174-858f-2e07db48e85&title=&width=1272.6666666666667" alt="image.png"><br>windows的__destruct  –&gt;removeFiles<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037833764-17392d82-2bcb-45e1-b8f0-7861e92de0ae.png#averageHue=%23262a2c&clientId=uc32c4d9b-bbe2-4&from=paste&height=243&id=u2a5aaf3d&originHeight=364&originWidth=1176&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=45045&status=done&style=none&taskId=uec814446-0a27-4e1b-aec5-dcf384d1133&title=&width=784" alt="image.png"><br>file_exists可触发tostring，filename可控<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037850425-2d7fb036-b432-47c5-ac3f-0b3e8032c759.png#averageHue=%23252728&clientId=uc32c4d9b-bbe2-4&from=paste&height=226&id=u49a09149&originHeight=339&originWidth=752&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=33719&status=done&style=none&taskId=u66c11a77-5f73-4c28-a957-9ef6f4a2f91&title=&width=501.3333333333333" alt="image.png"><br>payload这样写，触发Pivot的父类下修饰类Conversion的toString<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037875238-b88449d1-d0c9-45d4-b2b4-4ed390454fa4.png#averageHue=%23282c2d&clientId=uc32c4d9b-bbe2-4&from=paste&height=329&id=u58311ee2&originHeight=493&originWidth=1480&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=67438&status=done&style=none&taskId=u3d50ecb1-9c77-4c3d-87a0-938403c7644&title=&width=986.6666666666666" alt="image.png"><br>进toJson<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037901524-ba4516c2-2550-4411-b241-270e31db8827.png#averageHue=%23292c2e&clientId=uc32c4d9b-bbe2-4&from=paste&height=319&id=u81816d58&originHeight=478&originWidth=1296&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=77244&status=done&style=none&taskId=u78482e41-9af2-4500-bcee-1a3484ccf3e&title=&width=864" alt="image.png">进入toArray<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037925293-c78dd815-0fe1-4e3e-bf36-437578f41afe.png#averageHue=%23292c2c&clientId=uc32c4d9b-bbe2-4&from=paste&height=327&id=ubddd1653&originHeight=491&originWidth=1042&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=62655&status=done&style=none&taskId=uf0079cdd-8159-42be-bb31-b223fd7dea5&title=&width=694.6666666666666" alt="image.png"><br>往下看<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686037938253-da876740-89a8-4073-8d13-b46535696186.png#averageHue=%23242626&clientId=uc32c4d9b-bbe2-4&from=paste&height=559&id=ue86b680e&originHeight=839&originWidth=1529&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159040&status=done&style=none&taskId=u3fd814d9-53dd-490d-8eac-1f3c05e7f10&title=&width=1019.3333333333334" alt="image.png"><br>别的不管，就这些玩意<br>首先$this-&gt;append不能为空，遍历其键值，并且值得是个array<br>进入getRelation<br>relation得为空才能进入if，所以我们要这里函数返回为空<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038166762-09b4c420-03ad-4a79-9379-6ac64982a69f.png#averageHue=%23262c32&clientId=uc32c4d9b-bbe2-4&from=paste&height=249&id=ube85a44c&originHeight=374&originWidth=1556&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=66368&status=done&style=none&taskId=u4f123cd4-8648-48e6-ab75-d74c215f9fa&title=&width=1037.3333333333333" alt="image.png"><br>传入的key为Aecous,使name不为空，判断$this-&gt;relation中是否存在name键，很显然也没有，所以直接返回<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038213809-a268554a-4183-4c60-bd6c-909eee0d586c.png#averageHue=%236a7d6d&clientId=uc32c4d9b-bbe2-4&from=paste&height=146&id=u33ba71da&originHeight=219&originWidth=1166&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=29237&status=done&style=none&taskId=u4cd5f1ae-6c5c-48bc-9e50-f4ad0413f3b&title=&width=777.3333333333334" alt="image.png"><br>满足条件，进入getAttr<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038232516-dcc8a1ad-d7da-48e2-b2ec-9c266891a994.png#averageHue=%23252b2f&clientId=uc32c4d9b-bbe2-4&from=paste&height=275&id=u978ebfdb&originHeight=412&originWidth=1587&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=71274&status=done&style=none&taskId=u7d50ea42-88fa-463b-83bb-8ef7677553b&title=&width=1058" alt="image.png"><br>name为传入的key值Aecous进入getData<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038268614-8e6aea6a-9bb4-4a26-94a3-2457b3a9ce2e.png#averageHue=%23252b30&clientId=uc32c4d9b-bbe2-4&from=paste&height=273&id=ubc9f588a&originHeight=409&originWidth=1401&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=78981&status=done&style=none&taskId=u9f121665-782e-461b-a997-2da2ac0238d&title=&width=934" alt="image.png"><br>因name不为空，进入elseif判断this-&gt;data总是否存在name键，并返回其值，这里我们可以控制，编写poc<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038324621-1e99cf56-89dd-473a-9ea2-9cb3e3b6d501.png#averageHue=%23242626&clientId=uc32c4d9b-bbe2-4&from=paste&height=293&id=ua44c1673&originHeight=439&originWidth=899&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=39867&status=done&style=none&taskId=uddff299d-0376-40f7-987a-703c02fbd95&title=&width=599.3333333333334" alt="image.png"><br>因存在，所以返回new Request类赋值给$value<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038352863-67fdbf72-7add-4b3c-91db-1f39c82f74e2.png#averageHue=%23262e35&clientId=uc32c4d9b-bbe2-4&from=paste&height=169&id=u4f498ef8&originHeight=254&originWidth=1312&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=40339&status=done&style=none&taskId=u25183743-634d-4543-a16d-9af845fa5b3&title=&width=874.6666666666666" alt="image.png"><br>回到getData，直接返回$value赋值给$relation<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038387021-f668f4ac-a344-4406-9b7a-cebdadcdf6a5.png#averageHue=%23232525&clientId=uc32c4d9b-bbe2-4&from=paste&height=159&id=u9a8bc32f&originHeight=239&originWidth=1611&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=51699&status=done&style=none&taskId=u0079db4c-03f0-45a2-94ae-4a025e18cfb&title=&width=1074" alt="image.png"><br>调用Request-&gt;visible，因不存在此方法进入魔术函数call，mothod为函数名，args为Reuqest类<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038401910-cd792a96-f892-4dca-bde1-61fe1772b1cd.png#averageHue=%23262c30&clientId=uc32c4d9b-bbe2-4&from=paste&height=296&id=u4c87027c&originHeight=444&originWidth=1784&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=78362&status=done&style=none&taskId=uaf91b204-481f-4113-ad3b-906f043bc01&title=&width=1189.3333333333333" alt="image.png"><br>通过控制$this-hook[$method]，可以进行任意方法调用，进入isAjax<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038508438-a286b46b-c0f2-4235-bf08-cae9856e0668.png#averageHue=%23242a2e&clientId=uc32c4d9b-bbe2-4&from=paste&height=331&id=u6b0f1e87&originHeight=496&originWidth=1627&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=90635&status=done&style=none&taskId=u6c372dc9-b12e-4cc3-bc49-9d5032b25fe&title=&width=1084.6666666666667" alt="image.png"><br>this-&gt;config[‘var_ajax’]也可以进行控制，进入param方法<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038542274-ab1d4310-faa1-4f30-8b38-cd3b852e0c82.png#averageHue=%23242729&clientId=uc32c4d9b-bbe2-4&from=paste&height=783&id=u63c6f93e&originHeight=1174&originWidth=1703&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=176283&status=done&style=none&taskId=uf0e949b2-913f-472a-ae82-bb2579f7323&title=&width=1135.3333333333333" alt="image.png"><br>进入input方法<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038596701-32cb5018-8a43-4e02-adc7-c1509578c69f.png#averageHue=%2325292b&clientId=uc32c4d9b-bbe2-4&from=paste&height=616&id=uce3f3462&originHeight=924&originWidth=1739&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=132757&status=done&style=none&taskId=u65c02312-f74e-439b-a287-66e4d112cf1&title=&width=1159.3333333333333" alt="image.png">进入getData方法，name为$this-&gt;config[‘var_ajax’]的值，data为get的传参，从传参中获取参数为name所对应的值<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038610993-85ea946d-9467-4a9d-bba2-ab127c0188d0.png#averageHue=%2324292c&clientId=uc32c4d9b-bbe2-4&from=paste&height=371&id=ue03a2519&originHeight=557&originWidth=1694&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=85848&status=done&style=none&taskId=u3de2a482-88e1-4881-bb2c-a47fa0de113&title=&width=1129.3333333333333" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038717571-9ccf231a-44c1-4b19-8eb2-bfd7fa898f30.png#averageHue=%23252a2e&clientId=uc32c4d9b-bbe2-4&from=paste&height=359&id=udede23ba&originHeight=538&originWidth=1418&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=80126&status=done&style=none&taskId=ue2a6d7d0-16ca-4595-9be2-97efffb6474&title=&width=945.3333333333334" alt="image.png">获取传的Aecous&#x3D;whoami<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038735285-670c9468-6540-482b-87e6-3a091674a496.png#averageHue=%23252727&clientId=uc32c4d9b-bbe2-4&from=paste&height=528&id=u9388f348&originHeight=792&originWidth=1713&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=131591&status=done&style=none&taskId=ue7be7858-6f9d-4959-8379-a6a8923e669&title=&width=1142" alt="image.png">进入getFilter<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038746934-a2e4cc7d-e31a-45a1-85f3-3e5f6a252b0e.png#averageHue=%2324282b&clientId=uc32c4d9b-bbe2-4&from=paste&height=480&id=u2a737cbd&originHeight=720&originWidth=1692&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=87087&status=done&style=none&taskId=u0e8331c2-a437-4276-8e0c-41946537c64&title=&width=1128" alt="image.png">如果为空，则赋于this-&gt;filter的值，所以poc已形成<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038781073-0cf8b10d-8893-4b9f-8e47-5ce9b7b8a4e2.png#averageHue=%23232525&clientId=uc32c4d9b-bbe2-4&from=paste&height=289&id=u4df350bf&originHeight=434&originWidth=981&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=46348&status=done&style=none&taskId=u780f4672-858a-43e9-a14a-46610f9d02c&title=&width=654" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038798333-e0d4437b-7606-4cac-b3f2-6517ef2307f6.png#averageHue=%2324292b&clientId=uc32c4d9b-bbe2-4&from=paste&height=464&id=u9c63828b&originHeight=696&originWidth=1433&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=93159&status=done&style=none&taskId=u63903fc3-8c87-4125-ad6d-ab06a2ae35e&title=&width=955.3333333333334" alt="image.png">将filter赋值后转成数组，并加个新键，返回<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038826414-2811f8e8-2aec-4dea-9581-b4232df4f9bc.png#averageHue=%23272c30&clientId=uc32c4d9b-bbe2-4&from=paste&height=279&id=u2263c81a&originHeight=419&originWidth=1575&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=70460&status=done&style=none&taskId=u7bbe4e6e-5a07-489b-8df7-0cad5e2c624&title=&width=1050" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038850844-b166215d-529f-4996-9528-e4faab7aefb2.png#averageHue=%233f4751&clientId=uc32c4d9b-bbe2-4&from=paste&height=161&id=uce16b720&originHeight=242&originWidth=769&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21161&status=done&style=none&taskId=ua0a4a827-88b7-4a9c-a047-e039e581cd0&title=&width=512.6666666666666" alt="image.png"><br>进入filterValue<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686038868838-54e54769-91af-4f65-a6f2-905caebe3317.png#averageHue=%23252a2e&clientId=uc32c4d9b-bbe2-4&from=paste&height=342&id=ud5db75ae&originHeight=513&originWidth=1650&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=120854&status=done&style=none&taskId=u5133780a-bdeb-411a-9c19-01134148ad1&title=&width=1100" alt="image.png">对filters进行遍历取值，value为whoami<br>call_user_func进行任意函数调用 system(‘whoami’)<br>分析结束</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="thinkphp5-0-23-rce"><a href="#thinkphp5-0-23-rce" class="headerlink" title="thinkphp5.0.23 rce"></a>thinkphp5.0.23 rce</h3><p>记得他妈的开app_debug!!!!!<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686053354688-2d1691e4-2695-48c0-b603-df9c090234d3.png#averageHue=%2333373a&clientId=u40616a93-1171-4&from=paste&height=239&id=u146aff3f&originHeight=359&originWidth=970&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37319&status=done&style=none&taskId=ub83a5e16-3bb2-4e55-a3b1-26bbeccf0cf&title=&width=646.6666666666666" alt="image.png">	<br>payload<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102365286-770fb8ca-1b09-4363-b6c1-4b69e25be70d.png#averageHue=%23f6f6f6&clientId=u93ca1da7-cd71-4&from=paste&height=270&id=uade718a2&originHeight=405&originWidth=1070&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=51444&status=done&style=none&taskId=u32f24fab-f081-4288-afaa-c26d2a81d0f&title=&width=713.3333333333334" alt="image.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ip<span class="token operator">/</span>public<span class="token operator">/</span>?s<span class="token operator">=</span>captcha

_method<span class="token operator">=</span>__construct<span class="token operator">&amp;</span><span class="token builtin">filter</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>system<span class="token operator">&amp;</span>method<span class="token operator">=</span>get<span class="token operator">&amp;</span>get<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>calc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102393760-671161a1-5300-402f-aefb-fc25d84a3e70.png#averageHue=%23232525&clientId=u93ca1da7-cd71-4&from=paste&height=439&id=u8b5f3eeb&originHeight=659&originWidth=1190&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=46451&status=done&style=none&taskId=uf743175e-7613-4c80-bb4c-635bc2398eb&title=&width=793.3333333333334" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102430340-18b62f7d-169e-49a1-b634-87d18d81d89e.png#averageHue=%23292c2e&clientId=u93ca1da7-cd71-4&from=paste&height=661&id=u280f1e75&originHeight=991&originWidth=1828&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=164022&status=done&style=none&taskId=u6b55ce7b-b8f7-442b-ab01-279c3a75076&title=&width=1218.6666666666667" alt="image.png"><br>进入run，找到关键函数<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102443219-a3a3fd5a-5f90-4fe1-9cc0-2af02aadd5fe.png#averageHue=%23232525&clientId=u93ca1da7-cd71-4&from=paste&height=153&id=uf2336970&originHeight=229&originWidth=1163&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=32133&status=done&style=none&taskId=u910f2ba2-5fb0-4b61-904c-bc1c930a4d1&title=&width=775.3333333333334" alt="image.png">进入routeCheck<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102460975-7ce5e07d-741d-48bb-9c5f-a50ba31e1c13.png#averageHue=%2326292c&clientId=u93ca1da7-cd71-4&from=paste&height=660&id=u6205f4e4&originHeight=990&originWidth=1656&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=196105&status=done&style=none&taskId=u6b15596c-1b15-41cc-891a-a44cc3c7c5e&title=&width=1104" alt="image.png"><br>进入Route::check<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102477821-8423c677-2d3c-4f28-9c8d-aee9f18b602c.png#averageHue=%23272b2d&clientId=u93ca1da7-cd71-4&from=paste&height=615&id=u608d42f6&originHeight=922&originWidth=1869&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=182456&status=done&style=none&taskId=u9ae90c87-2802-4d75-9b89-15f7a381121&title=&width=1246" alt="image.png">进入$request-&gt;method()<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102493114-66aa0932-63ee-4e39-a12b-1addc4e3db3c.png#averageHue=%23262b2e&clientId=u93ca1da7-cd71-4&from=paste&height=375&id=ubeca3436&originHeight=563&originWidth=1921&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159395&status=done&style=none&taskId=u6eb43acf-9037-4f9f-9f63-20ccc3130eb&title=&width=1280.6666666666667" alt="image.png">关键点<br>判断是否存在_method参数，进入if<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102527023-d9be35fc-b8df-457e-ab71-b79c54b9c591.png#averageHue=%23313538&clientId=u93ca1da7-cd71-4&from=paste&height=668&id=u655ce3de&originHeight=1002&originWidth=1776&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=197360&status=done&style=none&taskId=uf2b819a3-460d-417f-ab8a-642407bfbb6&title=&width=1184" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102560193-efd60d85-95ef-421a-b5c3-48a463c7467d.png#averageHue=%23282f35&clientId=u93ca1da7-cd71-4&from=paste&height=239&id=u1961bb01&originHeight=359&originWidth=1621&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=122395&status=done&style=none&taskId=u0072f71a-0754-4dd3-8c32-a2654b57a35&title=&width=1080.6666666666667" alt="image.png"><br>一个任意函数调用，通过控制_method，进入__construct方法，post作为传参<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102591293-fc09e6fa-7b70-43bc-bbc0-d33ea5f2fe75.png#averageHue=%23282c2e&clientId=u93ca1da7-cd71-4&from=paste&height=620&id=ucf5e43e7&originHeight=930&originWidth=1880&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=173120&status=done&style=none&taskId=ucb65d99a-513e-4bd1-abfc-16c4ff73ca7&title=&width=1253.3333333333333" alt="image.png"><br>这里对post数组进行了遍历取出键值，检查当前类中是否存在该键，并且对该键进行赋值<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102701357-8be4b54e-6e7f-4d40-b3ea-b7242ce0495f.png#averageHue=%233e454e&clientId=u93ca1da7-cd71-4&from=paste&height=176&id=ud91865d7&originHeight=264&originWidth=634&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23127&status=done&style=none&taskId=uc4aed6f2-0ef4-4874-9aa5-328f5041586&title=&width=422.6666666666667" alt="image.png"><br>这里会将 filter&#x3D;[‘system’]  method&#x3D;”get”  get&#x3D;[“calc”]<br>回到App<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102766989-7952fa1b-a97d-4354-838d-74d15d3155fa.png#averageHue=%232b2f31&clientId=u93ca1da7-cd71-4&from=paste&height=654&id=u8c72c7e7&originHeight=981&originWidth=2124&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=207628&status=done&style=none&taskId=ud07bb9c8-56a8-4fd1-98f8-b19036ac4e4&title=&width=1416" alt="image.png"><br>进入$request-&gt;param<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102787478-0e3e6fc2-8266-4fff-aef7-9ea23b41f4ef.png#averageHue=%23272a2c&clientId=u93ca1da7-cd71-4&from=paste&height=703&id=u98233369&originHeight=1055&originWidth=1829&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=179587&status=done&style=none&taskId=u5f02d839-07c9-46e0-854c-118f9d8ece7&title=&width=1219.3333333333333" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686102804801-bc09b3f3-9f5e-4f7e-b8a7-dbc66db32b7e.png#averageHue=%23263039&clientId=u93ca1da7-cd71-4&from=paste&height=137&id=u7f56a85f&originHeight=206&originWidth=1807&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=36541&status=done&style=none&taskId=u197ed765-d901-4d28-b594-d460bb2206e&title=&width=1204.6666666666667" alt="image.png">对$this-&gt;param赋值，合并多个值，param为空数组，vars为空，进入get<br>return一个input函数，进入input，第一参数为get，是我们覆盖过的[“calc”]<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103510718-6d3f0aae-bd2c-4cca-b45a-9e5c4f6062d6.png#averageHue=%23242a2d&clientId=u93ca1da7-cd71-4&from=paste&height=324&id=u8df88887&originHeight=486&originWidth=1634&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=78279&status=done&style=none&taskId=u09674c63-f6bc-43f0-9d06-e3b323081dd&title=&width=1089.3333333333333" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103540410-10065504-5fc3-4672-95bc-0b71c197833f.png#averageHue=%23252b2f&clientId=u93ca1da7-cd71-4&from=paste&height=271&id=u5f4ca08b&originHeight=407&originWidth=1654&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=66586&status=done&style=none&taskId=u5de48569-9af2-4079-b3ec-4e45846a3f7&title=&width=1102.6666666666667" alt="image.png"><br>因为name为false，所以直接返回[“calc”]<br>再看看route<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103560961-f85096e9-d7ed-4f5a-86d0-048da258e2c5.png#averageHue=%23262b2e&clientId=u93ca1da7-cd71-4&from=paste&height=377&id=ua8b04192&originHeight=565&originWidth=1593&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=112991&status=done&style=none&taskId=ue6d93411-f4a8-441c-a3c0-ace8a28c273&title=&width=1062" alt="image.png"><br>也是一样，只不过传入的第一参数是$this-&gt;route<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103579615-501475d4-f9cd-41e0-ba97-62b4395dc31f.png#averageHue=%23252c32&clientId=u93ca1da7-cd71-4&from=paste&height=225&id=u9436aadc&originHeight=337&originWidth=1654&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=52932&status=done&style=none&taskId=u52c01977-fa57-425a-918e-da25272d7eb&title=&width=1102.6666666666667" alt="image.png"><br>返回是空数组<br>所以最后$this-&gt;param为[“calc”]<img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103609620-609d4f66-80a2-4d63-9e88-010823adb29e.png#averageHue=%233d444b&clientId=u93ca1da7-cd71-4&from=paste&height=221&id=u417e3eb8&originHeight=332&originWidth=1178&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=33163&status=done&style=none&taskId=u5fa89b0f-d6c9-4cea-b00b-38ec0da92cf&title=&width=785.3333333333334" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103621691-5369290f-22ca-46ad-905b-a8ed2e6e56b9.png#averageHue=%23282b2e&clientId=u93ca1da7-cd71-4&from=paste&height=639&id=u2c355adb&originHeight=959&originWidth=1763&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159459&status=done&style=none&taskId=ub75b5709-7604-4368-b629-8b65790ed84&title=&width=1175.3333333333333" alt="image.png"><br>继续往下走，还是一个input，传入$this-&gt;param<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103655025-a1070d28-8379-4042-8002-0c61c0256c1f.png#averageHue=%23292e30&clientId=u93ca1da7-cd71-4&from=paste&height=549&id=ucdcfd879&originHeight=823&originWidth=2093&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=143202&status=done&style=none&taskId=u5330570c-5083-410e-be96-0550c472d08&title=&width=1395.3333333333333" alt="image.png"><br>进入input的getFilter<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103671520-adf22979-7045-4e7e-980d-25404c50a2b8.png#averageHue=%2324282b&clientId=u93ca1da7-cd71-4&from=paste&height=459&id=ucf0f5ea3&originHeight=688&originWidth=1784&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=72737&status=done&style=none&taskId=ub20bbe3e-a258-4975-a3f8-83f228c2f67&title=&width=1189.3333333333333" alt="image.png">因为filter为空，一个条件表达式，把this-&gt;filter赋给filter ，this-&gt;filter是我们之前覆盖的[“system”]<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103731333-d08df3ff-0742-4ab9-8ec9-d8097b561d59.png#averageHue=%23282c2f&clientId=u93ca1da7-cd71-4&from=paste&height=499&id=u1513b1d4&originHeight=749&originWidth=1503&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=124662&status=done&style=none&taskId=u39810841-3b93-44d1-8edc-a8f50b477b8&title=&width=1002" alt="image.png"><br>添加了个空键值，返回<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686104194518-23838dd2-d014-4f92-9f4a-17ab4b4b36b5.png#averageHue=%23272c31&clientId=u93ca1da7-cd71-4&from=paste&height=344&id=UUyyU&originHeight=516&originWidth=1950&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=92853&status=done&style=none&taskId=u1e3c42a5-28df-4c23-a5fc-b92a10c850c&title=&width=1300" alt="image.png"><br>通过array_walk_recursive调用$this-&gt;filterValue<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1686103769902-f508f746-885f-478e-aa43-be2a5107dfda.png#averageHue=%23252a2e&clientId=u93ca1da7-cd71-4&from=paste&height=379&id=u51e14f92&originHeight=569&originWidth=1801&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=138420&status=done&style=none&taskId=uceb61228-45a0-4179-a720-43f151b24fd&title=&width=1200.6666666666667" alt="image.png"><br>从filter数组中遍历取值，call_user_func执行</p>
<h3 id="thinkphp3-sql注入"><a href="#thinkphp3-sql注入" class="headerlink" title="thinkphp3 sql注入"></a>thinkphp3 sql注入</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687509227304-9c3d5373-1a25-4424-9f4e-77c0ebce81db.png#averageHue=%23f5f5f5&clientId=u2ee41dc4-5f10-4&from=paste&height=397&id=u0b19360d&originHeight=596&originWidth=1430&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=48212&status=done&style=none&taskId=ue12a5713-e0f7-493e-89d8-34c50db415b&title=&width=953.3333333333334" alt="image.png"><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/250537#h2-1">https://www.anquanke.com/post/id/250537#h2-1</a><br>使用find函数进行注入<br><a target="_blank" rel="noopener" href="https://static.kancloud.cn/manual/thinkphp/1715">https://static.kancloud.cn/manual/thinkphp/1715</a><br>在index.php通过参数s直接访问sql路由，也可以像上面那样访问</p>
<pre class="line-numbers language-none"><code class="language-none">?s&#x3D;&#x2F;Home&#x2F;index&#x2F;sql&amp;id&#x3D;sql注入payload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>进入find函数<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687509765541-cf36410c-7d1e-460e-86c9-fc9e20df7b37.png#averageHue=%232a343b&clientId=u2ee41dc4-5f10-4&from=paste&height=133&id=ufb5a77da&originHeight=200&originWidth=1230&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=107938&status=done&style=none&taskId=u464bd2b4-b1fc-421f-a880-530762eafde&title=&width=820" alt="image.png">对传入的数据进行了判断，因options是数组，所以不进入if，这样options[‘where’]就不会变为数组<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687509851731-af4d2c6e-9754-4043-b8a8-32b31b7d15e5.png#averageHue=%2329343f&clientId=u2ee41dc4-5f10-4&from=paste&height=91&id=u59978714&originHeight=136&originWidth=1369&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=74294&status=done&style=none&taskId=ub655f82f-d0f1-4d10-ba5a-9978047b83d&title=&width=912.6666666666666" alt="image.png">进入_parseOptions函数<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687509934160-a2686bd9-d7cd-46c2-948a-d516a60cccfb.png#averageHue=%23282e32&clientId=u2ee41dc4-5f10-4&from=paste&height=345&id=u108c6f80&originHeight=517&originWidth=1443&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=274185&status=done&style=none&taskId=uc47f0d6b-6360-43a9-b140-8b830ecb024&title=&width=962" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510002804-25f379d7-6d98-4d8d-baf6-2e4c2841e6ee.png#averageHue=%2330363b&clientId=u2ee41dc4-5f10-4&from=paste&height=284&id=u2585f59a&originHeight=426&originWidth=1159&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=178431&status=done&style=none&taskId=ud61bcdd9-69e7-47cb-88e3-cf001857b0f&title=&width=772.6666666666666" alt="image.png"><br>因options[‘where’]为字符串，所以不进入if，绕过了_parseType中的intval处理，最终返回<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510051278-e2b0530a-eecd-45c1-b263-d03269fef267.png#averageHue=%232b3742&clientId=u2ee41dc4-5f10-4&from=paste&height=90&id=u5abc7b13&originHeight=135&originWidth=1071&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=69106&status=done&style=none&taskId=ucff4e9f5-c127-4ae8-a787-933c39cc5fd&title=&width=714" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510097327-80116634-8fe3-4e05-9a8a-cbbee5128352.png#averageHue=%23282d30&clientId=u2ee41dc4-5f10-4&from=paste&height=240&id=uecb72fc1&originHeight=360&originWidth=1164&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=158179&status=done&style=none&taskId=u0a5ebbcc-f86e-499a-8509-2adc8400afc&title=&width=776" alt="image.png">传入select函数中<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510089876-5d374fa1-68fe-45e9-98ff-dff8ad45a919.png#averageHue=%232a343e&clientId=u2ee41dc4-5f10-4&from=paste&height=127&id=ua984a3ad&originHeight=191&originWidth=1435&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=141398&status=done&style=none&taskId=u999d0330-99b0-42a9-93f3-b2d924975ab&title=&width=956.6666666666666" alt="image.png"><br>进行参数绑定处理，最终的语句为<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510131335-b0597aa6-ae94-44de-aa68-7cc0d67ebf54.png#averageHue=%234c6182&clientId=u2ee41dc4-5f10-4&from=paste&height=27&id=u38bfc374&originHeight=40&originWidth=786&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=15149&status=done&style=none&taskId=u68169a60-92c8-4c7b-86dc-334b11927c9&title=&width=524" alt="image.png"><br>执行后返回结果<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35213294/1687510164241-495a1e6f-1951-44e3-b9a3-d958a48a3993.png#averageHue=%23ebeaea&clientId=u2ee41dc4-5f10-4&from=paste&height=273&id=u1a163315&originHeight=273&originWidth=1254&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=40973&status=done&style=none&taskId=u4ef8300e-a4de-4dde-82f5-50d4b01b2ee&title=&width=1254" alt="image.png"></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2023/06/27/Imagick%E8%A7%A6%E5%8F%91msl/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2023-07-08 17:09:39
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2023/07/08/C3P0%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%94%A8%E6%B3%95/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#think5-1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">think5.1  反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thinkphp5-0-23-rce"><span class="toc-text">thinkphp5.0.23 rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thinkphp3-sql%E6%B3%A8%E5%85%A5"><span class="toc-text">thinkphp3 sql注入</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src='https://cdn.jsdelivr.net/npm/valine@1.4.18/dist/Valine.min.js' onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'bNa2jesvrDl0f51DIPiFWHCO-gzGzoHsz',
        appKey: 'UfLQ40Ou8xWfDtBEct4Yxct1',
        placeholder: 'welcome!',
        avatar: 'retro',
        lang: 'en'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2023 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + thinkphp%E7%9A%84%E4%B8%80%E4%BA%9B%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90 + '&url=' + http%3A%2F%2Fexample.com%2F2023%2F07%2F08%2Fthinkphp%25E7%259A%2584%25E4%25B8%2580%25E4%25BA%259B%25E6%25BC%258F%25E6%25B4%259E%25E8%25A7%25A3%25E6%259E%2590%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://example.com/2023/07/08/thinkphp%E7%9A%84%E4%B8%80%E4%BA%9B%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
